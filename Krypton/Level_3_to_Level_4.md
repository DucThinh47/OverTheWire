# Krypton Level 3 → Level 4

Level Info

Well done. You’ve moved past an easy substitution cipher.

The main weakness of a simple substitution cipher is repeated use of a simple key. In the previous exercise you were able to introduce arbitrary plaintext to expose the key. In this example, the cipher mechanism is not available to you, the attacker.

However, you have been lucky. You have intercepted more than one message. The password to the next level is found in the file ‘krypton4’. You have also found 3 other files. (found1, found2, found3)

You know the following important details:

The message plaintexts are in American English (*** very important) - They were produced from the same key (*** even better!)

Enjoy.

# Solution

Đăng nhập krypton3: 

![img](8)

Di chuyển vào thư mục /krypton/krypton3: 

![img](9)

Xem nội dung file krypton4:

![img](10)

Văn bản được mã hóa là **KSVVW BGSJD SVSIS VXBMN YQUUK BNWCU ANMJS**. 

Xem nội dung các file còn lại: 

![img](11)

Theo mô tả thử thách, đây là một mã thay thế kí tự dựa trên tần suất chữ cái. 

4 file mã hóa krypton4, found1, found2, found3, đều sử dụng cùng một khóa mã hóa => có thể tận dụng phân tích tần suất để tìm quy tắc thay thế.

Để tìm tần suất xuất hiện của các từ trong các file found1, found2, found3, trước tiên nối nội dung của các file lại, dùng lệnh: 

    cat found* | tr -d ' '

![img](12)

Script python dùng để tính tần suất xuất hiện của các từ trong chuỗi thu được:

    import string

    msg = "CGZNLYJBENQYDLQZQSUQNZCYDSNQVUBFGBKGQUQZQSUQNUZCYDSNJDSUDCXJZCYDSNZQSUQNUZBWSBNZQSUQNUDCXJCUBGSBXJDSUCTYVSUJQGWTBUJKCWSVLFGBKGSGZNLYJCBGJSZDGCHMSUCJCUQJLYSBXUMAUJCJMJCBGZCYDSNCGKDCZDSQZDVSJJSNCGJDSYVQCGJSOJCUNSYVQZSWALQVSJJSNUBTSXCOSWGMTASNBXYBUCJCBGUWBKGJDSQVYDQASJXBNSOQTYVSKCJDQUDCXJBXQKBMVWASNSYVQZSWALWAKBMVWASZBTSSQGWUBBGJDSTSJDBWCUGQTSWQXJSNRMVCMUZQSUQNKDBMUSWCJJBZBTTMGCZQJSKCJDDCUESGSNQVUJDSSGZNLYJCBGUJSYYSNXBNTSWALQZQSUQNZCYDSNCUBXJSGCGZBNYBNQJSWQUYQNJBXTBNSZBTYVSOUZDSTSUUMZDQUJDSICESGNSZCYDSNQGWUJCVVDQUTBWSNGQYYVCZQJCBGCGJDSNBJULUJSTQUKCJDQVVUCGEVSQVYDQASJUMAUJCJMJCBGZCYDSNUJDSZQSUQNZCYDSNCUSQUCVLANBFSGQGWCGYNQZJCZSBXXSNUSUUSGJCQVVLGBZBTTMGCZQJCBGUSZMNCJLUDQFSUYSQNSYNBWMZSWTBUJBXDCUFGBKGKBNFASJKSSGQGWDCUSQNVLYVQLUKSNSTQCGVLZBTSWCSUQGWDCUJBNCSUESGNSUDSNQCUSWJBJDSYSQFBXUBYDCUJCZQJCBGQGWQNJCUJNLALJDSSGWBXJDSUCOJSSGJDZSGJMNLGSOJDSKNBJSTQCGVLJNQESWCSUMGJCVQABMJCGZVMWCGEDQTVSJFCGEVSQNQGWTQZASJDZBGUCWSNSWUBTSBXJDSXCGSUJSOQTYVSUCGJDSSGEVCUDVQGEMQESCGDCUVQUJYDQUSDSKNBJSJNQECZBTSWCSUQVUBFGBKGQUNBTQGZSUQGWZBVVQABNQJSWKCJDBJDSNYVQLKNCEDJUTQGLBXDCUYVQLUKSNSYMAVCUDSWCGSWCJCBGUBXIQNLCGEHMQVCJLQGWQZZMNQZLWMNCGEDCUVCXSJCTSQGWCGJKBBXDCUXBNTSNJDSQJNCZQVZBVVSQEMSUYMAVCUDSWJDSXCNUJXBVCBQZBVVSZJSWSWCJCBGBXDCUWNQTQJCZKBNFUJDQJCGZVMWSWQVVAMJJKBBXJDSYVQLUGBKNSZBEGCUSWQUUDQFSUYSQNSUQVJDBMEDGBQJJSGWQGZSNSZBNWUXBNJDSYSNCBWUMNICISTBUJACBENQYDSNUQENSSJDQJUDQFSUYSQNSKQUSWMZQJSWQJJDSFCGEUGSKUZDBBVCGUJNQJXBNWQXNSSUZDBBVZDQNJSNSWCGQABMJQHMQNJSNBXQTCVSXNBTDCUDBTSENQTTQNUZDBBVUIQNCSWCGHMQVCJLWMNCGEJDSSVCPQASJDQGSNQAMJJDSZMNNCZMVMTKQUWCZJQJSWALVQKJDNBMEDBMJSGEVQGWQGWJDSUZDBBVKBMVWDQISYNBICWSWQGCGJSGUCISSWMZQJCBGCGVQJCGENQTTQNQGWJDSZVQUUCZUQJJDSQESBXUDQFSUYSQNSTQNNCSWJDSLSQNBVWQGGSDQJDQKQLJDSZBGUCUJBNLZBMNJBXJDSWCBZSUSBXKBNZSUJSNCUUMSWQTQNNCQESVCZSGZSBGGBISTASNJKBBXDQJDQKQLUGSCEDABMNUYBUJSWABGWUJDSGSOJWQLQUUMNSJLJDQJJDSNSKSNSGBCTYSWCTSGJUJBJDSTQNNCQESJDSZBMYVSTQLDQISQNNQGESWJDSZSNSTBGLCGUBTSDQUJSUCGZSJDSKBNZSUJSNZDQGZSVVBNQVVBKSWJDSTQNNCQESAQGGUJBASNSQWBGZSCGUJSQWBXJDSMUMQVJDNSSJCTSUQGGSUYNSEGQGZLZBMVWDQISASSGJDSNSQUBGXBNJDCUUCOTBGJDUQXJSNJDSTQNNCQESUDSEQISACNJDJBQWQMEDJSNUMUQGGQKDBKQUAQYJCUSWBGTQLJKCGUUBGDQTGSJQGWWQMEDJSNRMWCJDXBVVBKSWQVTBUJJKBLSQNUVQJSNQGWKSNSAQYJCUSWBGXSANMQNLDQTGSJWCSWBXMGFGBKGZQMUSUQJJDSQESBXQGWKQUAMNCSWBGQMEMUJQXJSNJDSACNJDBXJDSJKCGUJDSNSQNSXSKDCUJBNCZQVJNQZSUBXUDQFSUYSQNSMGJCVDSCUTSGJCBGSWQUYQNJBXJDSVBGWBGJDSQJNSUZSGSCGASZQMUSBXJDCUEQYUZDBVQNUNSXSNJBJDSLSQNUASJKSSGQGWQUUDQFSUYSQNSUVBUJLSQNUACBENQYDSNUQJJSTYJCGEJBQZZBMGJXBNJDCUYSNCBWDQISNSYBNJSWTQGLQYBZNLYDQVUJBNCSUGCZDBVQUNBKSUDQFSUYSQNSUXCNUJACBENQYDSNNSZBMGJSWQUJNQJXBNWVSESGWJDQJUDQFSUYSQNSXVSWJDSJBKGXBNVBGWBGJBSUZQYSYNBUSZMJCBGXBNWSSNYBQZDCGEQGBJDSNSCEDJSSGJDZSGJMNLUJBNLDQUUDQFSUYSQNSUJQNJCGEDCUJDSQJNCZQVZQNSSNTCGWCGEJDSDBNUSUBXJDSQJNSYQJNBGUCGVBGWBGRBDGQMANSLNSYBNJSWJDQJUDQFSUYSQNSDQWASSGQZBMGJNLUZDBBVTQUJSNUBTSJKSGJCSJDZSGJMNLUZDBVQNUDQISUMEESUJSWJDQJUDQFSUYSQNSTQLDQISASSGSTYVBLSWQUQUZDBBVTQUJSNALQVSOQGWSNDBEDJBGBXVQGZQUDCNSQZQJDBVCZVQGWBKGSNKDBGQTSWQZSNJQCGKCVVCQTUDQFSUDQXJSCGDCUKCVVGBSICWSGZSUMAUJQGJCQJSUUMZDUJBNCSUBJDSNJDQGDSQNUQLZBVVSZJSWQXJSNDCUWSQJDDSNSMYBGVSENQGWQNBUSKCJDQENQISQGWUJQJSVLQCNQGWANBMEDJTSJDSASSJVSXNBTQEVQUUZQUSCGKDCZDCJKQUSGZVBUSWCJKQUQASQMJCXMVUZQNQAQSMUQGWQJJDQJJCTSMGFGBKGJBGQJMNQVCUJUBXZBMNUSQENSQJYNCPSCGQUZCSGJCXCZYBCGJBXICSKJDSNSKSNSJKBNBMGWAVQZFUYBJUGSQNBGSSOJNSTCJLBXJDSAQZFQGWQVBGEBGSGSQNJDSBJDSNJDSUZQVSUKSNSSOZSSWCGEVLDQNWQGWEVBUULKCJDQVVJDSQYYSQNQGZSBXAMNGCUDSWEBVWJDSKSCEDJBXJDSCGUSZJKQUISNLNSTQNFQAVSQGWJQFCGEQVVJDCGEUCGJBZBGUCWSNQJCBGCZBMVWDQNWVLAVQTSRMYCJSNXBNDCUBYCGCBGNSUYSZJCGECJ"
    letter_freq = {}

    for c in string.ascii_uppercase:
        letter_freq[c] = 0

    for l in msg:
        if l in string.ascii_uppercase:
            letter_freq[l] +=1 

    s = [(k, letter_freq[k]) for k in sorted(letter_freq, key=letter_freq.get, reverse=True)]

    print(s)

Thực thi script, output: 

    [('S', 456), ('Q', 340), ('J', 301), ('U', 257), ('B', 246), ('N', 240), ('C', 227), ('G', 227), ('D', 210), ('Z', 132), ('V', 130), ('W', 129), ('M', 86), ('Y', 84), ('T', 75), ('X', 71), ('K', 67), ('E', 64), ('L', 60), ('A', 55), ('F', 28), ('I', 19), ('O', 12), ('H', 4), ('R', 4), ('P', 2)]

Tần suất xuất hiện các từ trong 3 file found*: S=>Q=>J=>U=>B=>N=>C=>G=>D=>Z=>V=>W=>M=>Y=>T=>X=>K=>E=>L=>A=>F=>I=>O=>H=>R=>P

Trong bảng chữ cái Tiếng Anh, đây là tần suất xuất hiện của các từ: E=>Q=>T=>S=>O=>R=>I=>N=>H=>C=>L=>D=>U=>P=>M=>F=>W=>G=>Y=>B=>K=>V=>X=>Q=>J=>Z

Script Python giải mã một bản mã thay thế dựa trên phân tích tần suất chữ cái trong tiếng Anh:

    import string

    ciphertext = "KSVVWBGSJDSVSISVXBMNYQUUKBNWCUANMJS"

    modified_freq = "EQTSORINHCLDUPMFWGYBKVXQJZ"
    ciphert_freq = "SQJUBNCGDZVWMYTXKELAFIOHRP"

    cleartext = ''
    for l in ciphertext:
        i = ciphert_freq.index(l)
        cleartext += modified_freq[i]

    print(cleartext)

Trong đó:

- ciphertext = "KSVVWBGSJDSVSISVXBMNYQUUKBNWCUANMJS": bản mã hóa cần giải (nội dung file krypton4 đã xóa dấu cách)
- ciphert_freq = "SQJUBNCGDZVWMYTXKELAFIOHRP": tần suất chữ cái trong bản mã (dựa vào thống kê khi phân tích 3 file found).
- modified_freq = "EQTSORINHCLDUPMFWGYBKVXQJZ":  tần suất chữ cái trong tiếng Anh

=> Nếu biết thứ tự tần suất chữ trong bản mã và văn bản gốc, có thể giải mã mà không cần khóa ban đầu. Đây là cách tiếp cận cơ bản để phá mã tần suất trong mật mã học.

Thực thi script, output: WELLDONETHELEVELFOURPQSSWORDISBRUTE

=> Password krypton4: WELLDONETHELEVELFOURPQSSWORDISBRUTE







